# CLAUDE.md - プロジェクトルールテンプレート

## プロジェクト概要
- **プロジェクト名**: 写真／動画キャプチャアプリ
- **目的**: Raspberry Piに接続されたカメラデバイスの制御方法を学び、Pythonを用いた画像・動画キャプチャ技術を習得する
- **対象**: プログラミング初心者、Raspberry Pi入門者、画像・動画処理の初学者

## 開発ルール

### 業務開始時の必須確認事項
- **要件定義書の確認**: 業務開始時は必ず要件定義書を読み返し、最新の要件と仕様を確認する
- **プロジェクト状況把握**: 現在の進捗状況と残タスクを確認する
- **変更履歴確認**: 前回からの変更点や更新事項をチェックする

### コーディング規約
- **言語**: Python 3.9以上
- **コーディングスタイル**: `python_coding_guidelines.md`に準拠（PEP8ベース）
  - `if __name__ == "__main__":`の使用必須
  - 関数化の徹底（グローバル実行コードの排除）
  - try-finallyによるクリーンアップ処理の確実な実行
  - すべての関数・クラスにdocstringを記述
  - 適切な命名規則（snake_case、PascalCase、UPPER_CASE）
- **ライブラリ**: Picamera2（優先）、OpenCV（代替）、argparse（コマンドライン引数処理）
- **コメント規約**: `COMMENT_STYLE_GUIDE.md`に準拠
  - 日本語でわかりやすくコメントを記入する
  - ファイルヘッダーに目的と要件定義書への参照を記載
  - クラス・関数にはdocstringを記述
  - 複雑な処理や重要な判定部分には必ずコメントを追加
  - 初心者向け教材として理解しやすい説明を心がける
  - トラブルシューティング情報を含める
- **関数分割**: 機能ごとに適切に分割（setup、main、cleanup関数の分離）
- **エラーハンドリング**: 必須実装（具体的な例外をキャッチ、初心者向けエラーメッセージ）

### ファイル構成ルール
- **メインスクリプト**: `photo_capture.py`, `video_capture.py`（機能別に分離）
- **ドキュメント**: `README.md`（英語で記載）
- **コーディング規約**: `python_coding_guidelines.md`, `COMMENT_STYLE_GUIDE.md`
- **依存関係**: `requirements.txt`
- **ライセンス**: `LICENSE`
- **要件定義**: `07-001_写真動画キャプチャアプリ_要件定義書.md`

### セキュリティルール
- **権限**: 最小権限の原則
- **入力検証**: 全ての引数とパラメータを検証
- **エラー情報**: 機密情報の漏洩防止
- **APIキー管理**:
  - **環境変数の使用必須**: APIキー、トークン、シークレットは必ず環境変数で管理する
  - コード内にAPIキーをハードコードしない
  - 設定ファイル（.mcp.json、.env等）に機密情報を記載する場合は必ず.gitignoreに追加
  - 環境変数の読み込み例：`os.environ.get('API_KEY')`
- **機密情報管理**:
  - ユーザー名、パスワード、APIキー、秘密鍵などの機密情報をGitHubにアップロードしない
  - 設定ファイルや環境変数ファイル（.env、.mcp.json等）は.gitignoreに追加
  - コード内にハードコードされた機密情報がないことを確認
  - 機密情報を含むファイルのサンプル（.env.sample等）を提供する場合は、実際の値を削除する
- **Git更新前の必須セキュリティチェック**:
  - **チェック1**: 追加・変更したファイルに機密情報が含まれていないか確認
  - **チェック2**: APIキー、パスワード、トークン、秘密鍵が含まれていないか検索
  - **チェック3**: .gitignoreに機密ファイルが正しく登録されているか確認
  - **チェック4**: git add前に`git diff`でファイル内容を再確認
  - **チェック5**: `git status`で意図しないファイルがステージングされていないか確認
  - 上記チェックをすべて完了してからコミット・プッシュを実行
- **機密情報漏洩時の対応**:
  - 直ちに該当のAPIキー・認証情報を無効化
  - Git履歴から機密情報を削除（git filter-branch等）
  - 新しい認証情報を環境変数で再設定

### テストルール
- **機能テスト**: 実装した機能の動作確認必須
- **引数テスト**: 各コマンドライン引数の検証
- **エラーテスト**: 異常系の動作確認
- **割り込みテスト**: 適切な終了処理の確認

### ドキュメントルール
- **README**: 英語で記載し、安全注意事項を必ず記載
- **使用例**: 具体的なコマンド例を提供
- **トラブルシューティング**: よくある問題と解決方法

### 運用ルール
- **バックアップ**: 重要な変更前にバックアップ
- **バージョン管理**: 機能追加時はバージョン番号更新
- **ログ**: タイムスタンプ付きで動作状況記録
- **終了処理**: 必ずリソースのクリーンアップ実行
- **Gitコミットメッセージ**: 英語で記載（例：Add photo capture feature, Fix camera initialization bug）

## 禁止事項
- **機密情報のハードコーディング**（APIキー、パスワード等は環境変数で管理）
- **セキュリティチェックを行わずにGit push**（必ず5項目のチェックを実施）
- 適切な権限なしでのリソース操作
- クリーンアップ処理の省略
- カメラリソースの適切な解放を行わない
- 複数の実装ライブラリの混在使用
- .gitignoreに登録すべき機密ファイルの追跡

## 推奨事項
- 定期的なコードレビュー
- 実装機能のテスト確認
- エラーログの適切な管理
- 教育効果を考慮した実装

---
最終更新: 2025-11-10
文書番号: 07-001